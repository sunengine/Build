(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[1],{2864:function(t,e,n){"use strict";n("ebb9")},3231:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment-container",attrs:{id:"comment-"+t.comment.id}},[t.isLast?n("div",{attrs:{id:"comment-last"}}):t._e(),t.comment.deletedDate?n("DeletedComment"):[t.isReadMode?n("Comment",{attrs:{comment:t.comment,canEdit:t.canEdit(),canMoveToTrash:t.canMoveToTrash()},on:{goEdit:t.goEdit}}):n("EditComment",{attrs:{commentId:t.comment.id},on:{done:t.saved,cancel:function(e){t.isReadMode=!0}}})]],2)},o=[],a=n("bd4c"),i={name:"CommentContainer",props:{comment:Object,categoryPersonalAccess:Object,isLast:{type:Boolean,default:!1},checkLastOwn:{type:Function,required:!0}},data(){return{isReadMode:!0}},methods:{async saved(){await this.$request(this.$Api.Comments.Get,{id:this.comment.id}).then((t=>{for(const e in t.data)this.comment[e]=t.data[e];this.isReadMode=!0}))},goEdit(){this.isReadMode=!1},canEdit(){if(!this.$store.state.auth.user||!this.categoryPersonalAccess)return!1;if(this.categoryPersonalAccess.CommentEditAny)return!0;if(this.comment.authorId!==this.$store.state.auth.user.id)return!1;if(!this.categoryPersonalAccess.CommentEditOwnIfHasReplies&&!this.checkLastOwn(this.comment))return!1;if(!this.categoryPersonalAccess.CommentEditOwnIfTimeNotExceeded){const t=new Date,e=new Date(this.comment.publishDate),n=a["a"].addToDate(e,{minutes:config.Comments.TimeToOwnEditInMinutes});if(n<t)return!1}return!!this.categoryPersonalAccess.CommentEditOwn},canMoveToTrash(){if(!this.$store.state.auth.user||!this.categoryPersonalAccess)return!1;if(this.categoryPersonalAccess.CommentDeleteAny)return!0;if(this.comment.authorId!==this.$store.state.auth.user.id)return!1;if(!this.categoryPersonalAccess.CommentDeleteOwnIfHasReplies&&!this.checkLastOwn(this.comment))return!1;if(!this.categoryPersonalAccess.CommentDeleteOwnIfTimeNotExceeded){const t=new Date,e=this.comment.publishDate,n=a["a"].addToDate(e,{minutes:config.Comments.TimeToOwnDeleteInMinutes});if(n<t)return!1}return!!this.categoryPersonalAccess.CommentDeleteOwn}},beforeCreate(){this.$options.components.Comment=n("9302").Comment,this.$options.components.EditComment=n("9302").EditComment,this.$options.components.DeletedComment=n("9302").DeletedComment}},c=i,r=n("2877"),m=Object(r["a"])(c,s,o,!1,null,null,null);e["a"]=m.exports},4517:function(t,e,n){},"93fb":function(t,e,n){"use strict";n("c96d")},a6fd:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"create-comment"},[n("SunEditor",{ref:"htmlEditor",staticClass:"create-comment__editor",attrs:{"content-class":"material-text",toolbar:t.editorToolbar,rules:t.commentRules},model:{value:t.comment.text,callback:function(e){t.$set(t.comment,"text",e)},expression:"comment.text"}}),n("div",[n("q-btn",{staticClass:"send-btn",attrs:{icon:t.$iconsSet.CreateComment.send,"no-caps":"",loading:t.loading,label:t.$tl("sendBtn")},on:{click:t.addComment}},[n("LoaderSent",{attrs:{slot:"loading"},slot:"loading"})],1)],1)],1)},o=[],a=n("6fb1"),i={name:"CreateComment",data(){return{comment:{materialId:this.materialId,text:""},loading:!1}},editorToolbar:null,props:{materialId:{type:Number,required:!0},done:Function},computed:{commentRules(){return[t=>!!t||this.$tl("required"),t=>{var e,n,s;return Object(a["htmlTextSizeOrHasImage"])(null===(e=this.$refs)||void 0===e||null===(n=e.htmlEditor)||void 0===n||null===(s=n.$refs)||void 0===s?void 0:s.content,5)||this.$tl("htmlTextSizeOrHasImage")}]},isNew:function(){return null==this.commentId}},methods:{async addComment(){this.$refs.htmlEditor.validate(),this.$refs.htmlEditor.hasError||(this.loading=!0,await this.$request(this.$Api.Comments.Create,{materialId:this.materialId,text:this.comment.text}).then((()=>{this.$successNotify(),this.comment.text="",this.$emit("done"),this.loading=!1})).catch((t=>{this.$errorNotify(t),this.loading=!1})),this.$refs.htmlEditor.resetValidation())}},beforeCreate(){this.editorToolbar=JSON.parse(config.Editor.CommentToolbar)}},c=i,r=(n("93fb"),n("2877")),m=n("9c40"),l=n("eebe"),d=n.n(l),h=Object(r["a"])(c,s,o,!1,null,null,null);e["a"]=h.exports;d()(h,"components",{QBtn:m["a"]})},c96d:function(t,e,n){},dd26:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("article",[n("div",{staticClass:"comment",attrs:{id:"comment-"+t.comment.id}},[n("q-avatar",{staticClass:"avatar comment__avatar"},[n("img",{attrs:{src:t.$avatarPath(t.comment.authorAvatar)}})]),n("div",{staticClass:"q-my-md"},[n("div",{staticClass:"q-mb-xs flex"},[n("router-link",{staticClass:"link user-link",attrs:{to:{name:"User",params:{link:t.comment.authorLink}}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.comment.authorName)+"\n\t\t\t\t\t")]),n("q-space"),n("div",{staticClass:"edit-btn-block q-gutter-x-lg q-mb-sm"},[t.canEdit?n("span",[n("a",{staticClass:"link",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.$emit("goEdit")}}},[t._v(t._s(t.$tl("edit")))])]):t._e(),t.canMoveToTrash?n("span",[n("a",{staticClass:"link",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.moveToTrash.apply(null,arguments)}}},[n("q-icon",{attrs:{name:t.$iconsSet.Comment.delete}})],1)]):t._e(),n("span",{staticClass:"material-footer-info-block"},[n("q-icon",{staticClass:"q-mr-xs",attrs:{name:t.$iconsSet.Comment.publishDate}}),n("time",{attrs:{datetime:t.$formatToSemTime(t.comment.publishDate)}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.$formatDate(t.comment.publishDate))+"\n\t\t\t\t\t\t\t")])],1),n("span",[n("a",{staticClass:"link",attrs:{href:t.$route.path+"#comment-"+t.comment.id},on:{click:t.linkToClipboard}},[t._v("#")])])])],1),n("div",{staticClass:"comment__text",domProps:{innerHTML:t._s(t.comment.text)}}),n("div",{staticClass:"clear"})])],1)])])},o=[],a=(n("ac1f"),n("a4c0")),i=n("cdde"),c={name:"Comment",props:{comment:Object,canEdit:{type:Boolean,default:!1},canMoveToTrash:{type:Boolean,default:!1},goEdit:Function},methods:{linkToClipboard(t){t.preventDefault();const e=window.location.href.split("#")[0]+"#comment-"+this.comment.id;return Object(i["a"])(e).then((()=>this.$successNotify(this.$tl("linkCopied")))).catch((()=>this.$router.push(e))),!1},prepareLocalLinks(){a["a"].call(this,this.$el,"comment__text")},moveToTrash(){const t=this.$tl("deleteDialogMessage"),e=this.$t("Global.dialog.ok"),n=this.$t("Global.dialog.cancel");this.$q.dialog({title:t,ok:e,cancel:n}).onOk((async()=>{await this.$request(this.$Api.Comments.MoveToTrash,{id:this.comment.id}).then((()=>{const t=this.$tl("moveToTrashSuccess");this.$successNotify(t),this.comment.deletedDate=new Date})).catch((t=>{this.$errorNotify(t)}))}))}},mounted(){this.prepareLocalLinks()}},r=c,m=(n("2864"),n("2877")),l=n("cb32"),d=n("2c91"),h=n("0016"),u=n("eebe"),f=n.n(u),p=Object(m["a"])(r,s,o,!1,null,null,null);e["a"]=p.exports;f()(p,"components",{QAvatar:l["a"],QSpace:d["a"],QIcon:h["a"]})},dd31:function(t,e,n){"use strict";n("4517")},e91d:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"deleted-comment q-ml-lg text-grey-8"},[t._v("\n\t"+t._s(t.$tl("label"))+"\n")])},o=[],a={name:"DeletedComment"},i=a,c=n("2877"),r=Object(c["a"])(i,s,o,!1,null,null,null);e["a"]=r.exports},e9bc:function(t,e,n){"use strict";var s=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"edit-comment"},[t.comment?[n("SunEditor",{ref:"htmlEditor",staticClass:"editor",attrs:{"content-class":"comment__text",toolbar:t.editorToolbar,rules:t.commentRules},model:{value:t.comment.text,callback:function(e){t.$set(t.comment,"text",e)},expression:"comment.text"}}),n("div",[n("q-btn",{staticClass:"send-btn",attrs:{icon:t.$iconsSet.EditComment.save,"no-caps":"",loading:t.loading,label:t.$tl("updateBtn")},on:{click:t.updateComment}},[n("LoaderSent",{attrs:{slot:"loading"},slot:"loading"})],1),n("q-btn",{staticClass:"cancel-btn q-ml-sm",attrs:{"no-caps":"",icon:t.$iconsSet.EditComment.cancel,label:t.$tl("cancelBtn")},on:{click:function(e){return t.$emit("cancel")}}})],1)]:n("LoaderWait")],2)},o=[],a=n("6fb1"),i={name:"EditComment",data(){return{comment:null,loading:!1}},props:{commentId:{type:Number,required:!0},done:Function},computed:{commentRules(){return[t=>!!t||this.$tl("required"),t=>{var e,n,s;return Object(a["htmlTextSizeOrHasImage"])(null===(e=this.$refs)||void 0===e||null===(n=e.htmlEditor)||void 0===n||null===(s=n.$refs)||void 0===s?void 0:s.content,5)||this.$tl("htmlTextSizeOrHasImage")}]}},methods:{async updateComment(){this.$refs.htmlEditor.validate(),this.$refs.htmlEditor.hasError||(this.loading=!0,await this.$request(this.$Api.Comments.Update,{Id:this.commentId,MaterialId:this.comment.materialId,Text:this.comment.text}).then((()=>{this.$successNotify(),this.$emit("done"),this.loading=!1})).catch((t=>{this.$errorNotify(t),this.loading=!1})),this.$refs.htmlEditor.resetValidation())}},beforeCreate(){this.editorToolbar=JSON.parse(config.Editor.CommentToolbar)},created(){this.$request(this.$Api.Comments.Get,{id:this.commentId}).then((t=>{this.comment=t.data}))}},c=i,r=(n("dd31"),n("2877")),m=n("9c40"),l=n("eebe"),d=n.n(l),h=Object(r["a"])(c,s,o,!1,null,null,null);e["a"]=h.exports;d()(h,"components",{QBtn:m["a"]})},ebb9:function(t,e,n){}}]);
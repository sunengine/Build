(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{2864:function(t,e,n){"use strict";var o=n("ebb9"),a=n.n(o);a.a},3231:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"comment-container",attrs:{id:"comment-"+t.comment.id}},[t.isLast?n("div",{attrs:{id:"comment-last"}}):t._e(),t.comment.deletedDate?n("DeletedComment"):[t.isReadMode?n("Comment",{attrs:{comment:t.comment,canEdit:t.canEdit(),canMoveToTrash:t.canMoveToTrash()},on:{goEdit:t.goEdit}}):n("EditComment",{attrs:{commentId:t.comment.id},on:{done:t.saved,cancel:function(e){t.isReadMode=!0}}})]],2)},a=[],s=n("967e"),i=n.n(s),r=(n("96cf"),n("fa84")),c=n.n(r),m=n("bd4c"),l={name:"CommentContainer",props:{comment:Object,categoryPersonalAccess:Object,isLast:{type:Boolean,default:!1},checkLastOwn:{type:Function,required:!0}},data:function(){return{isReadMode:!0}},methods:{saved:function(){var t=this;return c()(i.a.mark((function e(){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$request(t.$Api.Comments.Get,{id:t.comment.id}).then((function(e){for(var n in e.data)t.comment[n]=e.data[n];t.isReadMode=!0}));case 2:case"end":return e.stop()}}),e)})))()},goEdit:function(){this.isReadMode=!1},canEdit:function(){if(!this.$store.state.auth.user||!this.categoryPersonalAccess)return!1;if(this.categoryPersonalAccess.CommentEditAny)return!0;if(this.comment.authorId!==this.$store.state.auth.user.id)return!1;if(!this.categoryPersonalAccess.CommentEditOwnIfHasReplies&&!this.checkLastOwn(this.comment))return!1;if(!this.categoryPersonalAccess.CommentEditOwnIfTimeNotExceeded){var t=new Date,e=new Date(this.comment.publishDate),n=m["a"].addToDate(e,{minutes:config.Comments.TimeToOwnEditInMinutes});if(n<t)return!1}return!!this.categoryPersonalAccess.CommentEditOwn},canMoveToTrash:function(){if(!this.$store.state.auth.user||!this.categoryPersonalAccess)return!1;if(this.categoryPersonalAccess.CommentDeleteAny)return!0;if(this.comment.authorId!==this.$store.state.auth.user.id)return!1;if(!this.categoryPersonalAccess.CommentDeleteOwnIfHasReplies&&!this.checkLastOwn(this.comment))return!1;if(!this.categoryPersonalAccess.CommentDeleteOwnIfTimeNotExceeded){var t=new Date,e=this.comment.publishDate,n=m["a"].addToDate(e,{minutes:config.Comments.TimeToOwnDeleteInMinutes});if(n<t)return!1}return!!this.categoryPersonalAccess.CommentDeleteOwn}},beforeCreate:function(){this.$options.components.Comment=n("9302").Comment,this.$options.components.EditComment=n("9302").EditComment,this.$options.components.DeletedComment=n("9302").DeletedComment}},u=l,d=n("2877"),f=Object(d["a"])(u,o,a,!1,null,null,null);e["a"]=f.exports},4517:function(t,e,n){},"93fb":function(t,e,n){"use strict";var o=n("c96d"),a=n.n(o);a.a},a6fd:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"create-comment"},[n("SunEditor",{ref:"htmlEditor",staticClass:"create-comment__editor",attrs:{"content-class":"material-text",toolbar:t.editorToolbar,rules:t.commentRules},model:{value:t.comment.text,callback:function(e){t.$set(t.comment,"text",e)},expression:"comment.text"}}),n("div",[n("q-btn",{staticClass:"send-btn",attrs:{icon:t.$iconsSet.CreateComment.send,"no-caps":"",loading:t.loading,label:t.$tl("sendBtn")},on:{click:t.addComment}},[n("LoaderSent",{attrs:{slot:"loading"},slot:"loading"})],1)],1)],1)},a=[],s=n("967e"),i=n.n(s),r=(n("96cf"),n("fa84")),c=n.n(r),m=(n("c5f6"),n("6fb1")),l={name:"CreateComment",data:function(){return{comment:{materialId:this.materialId,text:""},loading:!1}},editorToolbar:null,props:{materialId:{type:Number,required:!0},done:Function},computed:{commentRules:function(){var t=this;return[function(e){return!!e||t.$tl("required")},function(e){var n,o,a;return Object(m["htmlTextSizeOrHasImage"])(null===(n=t.$refs)||void 0===n||null===(o=n.htmlEditor)||void 0===o||null===(a=o.$refs)||void 0===a?void 0:a.content,5)||t.$tl("htmlTextSizeOrHasImage")}]},isNew:function(){return null==this.commentId}},methods:{addComment:function(){var t=this;return c()(i.a.mark((function e(){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$refs.htmlEditor.validate(),!t.$refs.htmlEditor.hasError){e.next=3;break}return e.abrupt("return");case 3:return t.loading=!0,e.next=6,t.$request(t.$Api.Comments.Create,{materialId:t.materialId,text:t.comment.text}).then((function(){t.$successNotify(),t.comment.text="",t.$emit("done"),t.loading=!1})).catch((function(e){t.$errorNotify(e),t.loading=!1}));case 6:t.$refs.htmlEditor.resetValidation();case 7:case"end":return e.stop()}}),e)})))()}},beforeCreate:function(){this.editorToolbar=JSON.parse(config.Editor.CommentToolbar)}},u=l,d=(n("93fb"),n("2877")),f=n("9c40"),h=n("eebe"),p=n.n(h),v=Object(d["a"])(u,o,a,!1,null,null,null);e["a"]=v.exports;p()(v,"components",{QBtn:f["a"]})},c96d:function(t,e,n){},dd26:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("section",[n("article",[n("div",{staticClass:"comment",attrs:{id:"comment-"+t.comment.id}},[n("q-avatar",{staticClass:"avatar comment__avatar"},[n("img",{attrs:{src:t.$avatarPath(t.comment.authorAvatar)}})]),n("div",{staticClass:"q-my-md"},[n("div",{staticClass:"q-mb-xs flex"},[n("router-link",{staticClass:"link user-link",attrs:{to:{name:"User",params:{link:t.comment.authorLink}}}},[t._v("\n\t\t\t\t\t\t"+t._s(t.comment.authorName)+"\n\t\t\t\t\t")]),n("q-space"),n("div",{staticClass:"edit-btn-block q-gutter-x-lg q-mb-sm"},[t.canEdit?n("span",[n("a",{staticClass:"link",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.$emit("goEdit")}}},[t._v(t._s(t.$tl("edit")))])]):t._e(),t.canMoveToTrash?n("span",[n("a",{staticClass:"link",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.moveToTrash(e)}}},[n("q-icon",{attrs:{name:t.$iconsSet.Comment.delete}})],1)]):t._e(),n("span",{staticClass:"material-footer-info-block"},[n("q-icon",{staticClass:"q-mr-xs",attrs:{name:t.$iconsSet.Comment.publishDate}}),n("time",{attrs:{datetime:t.$formatToSemTime(t.comment.publishDate)}},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(t.$formatDate(t.comment.publishDate))+"\n\t\t\t\t\t\t\t")])],1),n("span",[n("a",{staticClass:"link",attrs:{href:t.$route.path+"#comment-"+t.comment.id},on:{click:t.linkToClipboard}},[t._v("#")])])])],1),n("div",{staticClass:"comment__text",domProps:{innerHTML:t._s(t.comment.text)}}),n("div",{staticClass:"clear"})])],1)])])},a=[],s=n("967e"),i=n.n(s),r=(n("96cf"),n("fa84")),c=n.n(r),m=(n("28a5"),n("a4c0")),l=n("cdde"),u={name:"Comment",props:{comment:Object,canEdit:{type:Boolean,default:!1},canMoveToTrash:{type:Boolean,default:!1},goEdit:Function},methods:{linkToClipboard:function(t){var e=this;t.preventDefault();var n=window.location.href.split("#")[0]+"#comment-"+this.comment.id;return Object(l["a"])(n).then((function(){return e.$successNotify(e.$tl("linkCopied"))})).catch((function(){return e.$router.push(n)})),!1},prepareLocalLinks:function(){m["a"].call(this,this.$el,"comment__text")},moveToTrash:function(){var t=this,e=this.$tl("deleteDialogMessage"),n=this.$t("Global.dialog.ok"),o=this.$t("Global.dialog.cancel");this.$q.dialog({title:e,ok:n,cancel:o}).onOk(c()(i.a.mark((function e(){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$request(t.$Api.Comments.MoveToTrash,{id:t.comment.id}).then((function(){var e=t.$tl("moveToTrashSuccess");t.$successNotify(e),t.comment.deletedDate=new Date})).catch((function(e){t.$errorNotify(e)}));case 2:case"end":return e.stop()}}),e)}))))}},mounted:function(){this.prepareLocalLinks()}},d=u,f=(n("2864"),n("2877")),h=n("cb32"),p=n("2c91"),v=n("0016"),C=n("eebe"),b=n.n(C),$=Object(f["a"])(d,o,a,!1,null,null,null);e["a"]=$.exports;b()($,"components",{QAvatar:h["a"],QSpace:p["a"],QIcon:v["a"]})},dd31:function(t,e,n){"use strict";var o=n("4517"),a=n.n(o);a.a},e91d:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"deleted-comment q-ml-lg text-grey-8"},[t._v("\n\t"+t._s(t.$tl("label"))+"\n")])},a=[],s={name:"DeletedComment"},i=s,r=n("2877"),c=Object(r["a"])(i,o,a,!1,null,null,null);e["a"]=c.exports},e9bc:function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"edit-comment"},[t.comment?[n("SunEditor",{ref:"htmlEditor",staticClass:"editor",attrs:{"content-class":"comment__text",toolbar:t.editorToolbar,rules:t.commentRules},model:{value:t.comment.text,callback:function(e){t.$set(t.comment,"text",e)},expression:"comment.text"}}),n("div",[n("q-btn",{staticClass:"send-btn",attrs:{icon:t.$iconsSet.EditComment.save,"no-caps":"",loading:t.loading,label:t.$tl("updateBtn")},on:{click:t.updateComment}},[n("LoaderSent",{attrs:{slot:"loading"},slot:"loading"})],1),n("q-btn",{staticClass:"cancel-btn q-ml-sm",attrs:{"no-caps":"",icon:t.$iconsSet.EditComment.cancel,label:t.$tl("cancelBtn")},on:{click:function(e){return t.$emit("cancel")}}})],1)]:n("LoaderWait")],2)},a=[],s=n("967e"),i=n.n(s),r=(n("96cf"),n("fa84")),c=n.n(r),m=(n("c5f6"),n("6fb1")),l={name:"EditComment",data:function(){return{comment:null,loading:!1}},props:{commentId:{type:Number,required:!0},done:Function},computed:{commentRules:function(){var t=this;return[function(e){return!!e||t.$tl("required")},function(e){var n,o,a;return Object(m["htmlTextSizeOrHasImage"])(null===(n=t.$refs)||void 0===n||null===(o=n.htmlEditor)||void 0===o||null===(a=o.$refs)||void 0===a?void 0:a.content,5)||t.$tl("htmlTextSizeOrHasImage")}]}},methods:{updateComment:function(){var t=this;return c()(i.a.mark((function e(){return i.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.$refs.htmlEditor.validate(),!t.$refs.htmlEditor.hasError){e.next=3;break}return e.abrupt("return");case 3:return t.loading=!0,e.next=6,t.$request(t.$Api.Comments.Update,{Id:t.commentId,MaterialId:t.comment.materialId,Text:t.comment.text}).then((function(){t.$successNotify(),t.$emit("done"),t.loading=!1})).catch((function(e){t.$errorNotify(e),t.loading=!1}));case 6:t.$refs.htmlEditor.resetValidation();case 7:case"end":return e.stop()}}),e)})))()}},beforeCreate:function(){this.editorToolbar=JSON.parse(config.Editor.CommentToolbar)},created:function(){var t=this;this.$request(this.$Api.Comments.Get,{id:this.commentId}).then((function(e){t.comment=e.data}))}},u=l,d=(n("dd31"),n("2877")),f=n("9c40"),h=n("eebe"),p=n.n(h),v=Object(d["a"])(u,o,a,!1,null,null,null);e["a"]=v.exports;p()(v,"components",{QBtn:f["a"]})},ebb9:function(t,e,n){}}]);